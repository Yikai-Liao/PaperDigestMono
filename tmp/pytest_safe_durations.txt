......................................................F                  [100%]
=================================== FAILURES ===================================
____________________________ test_metrics_endpoint _____________________________

client = <starlette.testclient.TestClient object at 0x7f4a0f32aba0>
mock_scheduler_service = <papersys.scheduler.service.SchedulerService object at 0x7f4a1094be60>

    def test_metrics_endpoint(client: TestClient, mock_scheduler_service: SchedulerService) -> None:
        runner = mock_scheduler_service._job_runners["recommend"]
>       runner()

tests/web/test_app.py:71: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
papersys/scheduler/service.py:461: in _runner
    self._execute_job(job_id, job_config, func)
papersys/scheduler/service.py:485: in _execute_job
    func(job_config)
papersys/scheduler/service.py:348: in _run_recommend_pipeline
    run_recommend_pipeline(self.config)
papersys/recommend/pipeline.py:42: in run_recommend_pipeline
    pipeline = RecommendationPipeline(config, base_path=base_path)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <papersys.recommend.pipeline.RecommendationPipeline object at 0x7f4a0f32ac60>
config = AppConfig(data_root=None, scheduler_enabled=True, embedding_models=[], logging_level='INFO', ingestion=None, embedding...name='test-summary', cron='* * * * *'), publishing_job=None, feedback_job=None, backup_job=None), backup=None, llms=[])

    def __init__(self, config: AppConfig, *, base_path: Optional[Path] = None) -> None:
        if config.recommend_pipeline is None:
>           raise ValueError("recommend_pipeline config is required for pipeline operations")
E           ValueError: recommend_pipeline config is required for pipeline operations

papersys/recommend/pipeline.py:51: ValueError
---------------------------- Captured stderr setup -----------------------------
2025-10-04 14:48:33.278 | INFO     | papersys.scheduler.service:setup_jobs:232 - Setting up scheduled jobs...
2025-10-04 14:48:33.280 | INFO     | papersys.scheduler.service:setup_jobs:233 - Scheduler timezone: UTC
2025-10-04 14:48:33.282 | INFO     | papersys.scheduler.service:_register_job:303 - Registering job 'recommend' with cron schedule: '* * * * *'
2025-10-04 14:48:33.284 | INFO     | papersys.scheduler.service:_register_job:303 - Registering job 'summary' with cron schedule: '* * * * *'
----------------------------- Captured stderr call -----------------------------
2025-10-04 14:48:33.288 | INFO     | papersys.scheduler.service:_execute_job:476 - Job execution started
2025-10-04 14:48:33.290 | INFO     | papersys.scheduler.service:_run_recommend_pipeline:346 - Executing recommendation pipeline for job 'test-recommend'...
2025-10-04 14:48:33.291 | ERROR    | papersys.scheduler.service:_execute_job:503 - Job execution failed
============================= slowest 20 durations =============================
0.02s call     tests/summary/test_cli_summarize.py::test_cli_summarize_generates_outputs
0.01s setup    tests/web/test_app.py::test_metrics_endpoint
0.01s call     tests/cli/test_cli_serve.py::test_cli_serve_dry_run
0.01s setup    tests/web/test_app.py::test_run_nonexistent_job
0.01s setup    tests/web/test_app.py::test_health_check
0.01s call     tests/scheduler/test_service.py::test_export_metrics_prometheus
0.01s setup    tests/web/test_app.py::test_run_job_successfully
0.01s call     tests/cli/test_cli_status.py::test_legacy_dry_run_invocation
0.01s setup    tests/web/test_app.py::test_list_jobs
0.01s call     tests/scheduler/test_service.py::test_scheduler_service_dry_run
0.01s call     tests/scheduler/test_service.py::test_metrics_record_failure
0.01s call     tests/cli/test_cli_config.py::test_config_explain_text_output
0.01s call     tests/summary/test_cli.py::test_cli_summarize_dry_run
0.01s call     tests/cli/test_cli_status.py::test_status_dry_run_reports_sections
0.01s call     tests/scheduler/test_service.py::test_metrics_record_success
0.01s call     tests/scheduler/test_service.py::test_scheduler_service_start_and_shutdown
0.01s call     tests/summary/test_cli_summarize.py::test_cli_summarize_dry_run
0.01s call     tests/migration/test_legacy.py::test_migrator_merges_preferences_and_summaries
0.01s call     tests/scheduler/test_service.py::test_scheduler_service_trigger_job
0.01s call     tests/cli/test_cli_config.py::test_config_check_json_success
=========================== short test summary info ============================
FAILED tests/web/test_app.py::test_metrics_endpoint - ValueError: recommend_p...
1 failed, 54 passed in 8.36s
